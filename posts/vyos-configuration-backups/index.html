<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="en-GB"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="VyOS - Configuration Backups" /><meta property="og:locale" content="en" /><meta name="description" content="VyOS Configuration Backups Backups aren’t an exciting topic, but essential if like me you dabble and don’t always get it right. There’s several get out of jail features with VyOS and we’ll discuss them here." /><meta property="og:description" content="VyOS Configuration Backups Backups aren’t an exciting topic, but essential if like me you dabble and don’t always get it right. There’s several get out of jail features with VyOS and we’ll discuss them here." /><link rel="canonical" href="https://blog.cymylau.uk/posts/vyos-configuration-backups/" /><meta property="og:url" content="https://blog.cymylau.uk/posts/vyos-configuration-backups/" /><meta property="og:site_name" content="blog.cymylau.uk" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-30T20:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="VyOS - Configuration Backups" /><meta name="twitter:site" content="@richjjoh" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-30T20:00:00+01:00","datePublished":"2022-06-30T20:00:00+01:00","description":"VyOS Configuration Backups Backups aren’t an exciting topic, but essential if like me you dabble and don’t always get it right. There’s several get out of jail features with VyOS and we’ll discuss them here.","headline":"VyOS - Configuration Backups","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.cymylau.uk/posts/vyos-configuration-backups/"},"url":"https://blog.cymylau.uk/posts/vyos-configuration-backups/"}</script><title>VyOS - Configuration Backups | blog.cymylau.uk</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="blog.cymylau.uk"><meta name="application-name" content="blog.cymylau.uk"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://media-exp1.licdn.com/dms/image/C4E03AQExqBX4lUs3Rg/profile-displayphoto-shrink_200_200/0/1651232416054?e=1659571200&v=beta&t=i7ERskeAwMsAtnvagJHwy5X17-Io4ffv_fP_BcunXmY " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">blog.cymylau.uk</a></div><div class="site-subtitle font-italic">My blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/richjjoh" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/richjjoh" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>VyOS - Configuration Backups</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>VyOS - Configuration Backups</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Rich Johnson</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1656615600" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-30 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="646 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><h1 id="vyos-configuration-backups">VyOS Configuration Backups</h1><p>Backups aren’t an exciting topic, but essential if like me you dabble and don’t always get it right. There’s several get out of jail features with VyOS and we’ll discuss them here.</p><p>With any backup, it’s always best to follow the 3,2,1 rule. 3 copies, 2 local and atleast 1 remote.</p><h1 id="commit-confirm">Commit Confirm</h1><p>There’s a great feature that I’d recommend you all to consider using “commit-confirm”. If you’re making a somewhat risky configuration change replace “commit” with “commit-confirm”. By default within 10 minutes after performing a “commit-confirm” if you don’t issue a “confirm” command the system will automatically reboot, taking you back to the previous configuation.</p><h1 id="commit-history">Commit History</h1><p>The default commit history is 100, however, this can be increased. It’ll use up more disk space but the files are small. You’d have to be in a very tight disk space situation to be concerned by this.</p><h1 id="increase-commit-history">Increase Commit History</h1><p>We can increase the local commit history, to my knowledge there’s only two real concerns in doing so. Firstly local disk space, secondly remote disk space if you’re sending the archive remotely. The more history you store, depending on your rate of change more diskspace will be consumed.</p><p>Storage these days is cheap, so I increase it to 1,000. Use any value you’re comfortable with. I think this value is silly high, but as a learning tool I like knowing I could, if I wanted to easy compare my current configuration to one months ago.</p><p>Enter configuration mode:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>configure
</pre></table></code></div></div><p>Alter the commit revisions to desired value (default 100)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">set </span>system config-management commit-revisions x
</pre></table></code></div></div><p>Example:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>richj@ph-gfw01# <span class="nb">set </span>system config-management commit-revisions 1000
<span class="o">[</span>edit]
</pre></table></code></div></div><h1 id="reverting-to-a-previous-commit">Reverting to a previous commit</h1><p>This is called rolling back in VyOS language, first we need to establish which previous commit we want to go back to. We can use the “compare” command for this - using the tab complete, issue a “compare” tab to view the list of available commits. You’ll now be able to see just host much has changed.</p><p>Issue compare, then use tab complete to list availble revisions. Lowest number is most recent.</p><p>Command: “Compare X” substitute x with your chosen commit revision.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>compare 3
</pre></table></code></div></div><p>Example:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>richj@ph-gfw01# compare 3
<span class="o">[</span>edit traffic-policy shaper 1gbps class 5]
+ceiling 300mbit
<span class="o">[</span>edit]
</pre></table></code></div></div><p>In the above example, compared to my current active configuration there was a traffic shaping policy applied. If I revert to this commit, I’ll be reinstanting that configuyration of having a traffic shaping policy.</p><p>A “+” denotes it will be added to your current “as is” configuration, if applied. c A “-“ denotes it will remove from your current “as is” configuration if applied.</p><p>It may take some time to find a suitable commit. In my experience I’m only tending to go back a few commits when I’ve been playing with a setting or two but incremented its configuration slowly over several commits.</p><p>Once we’ve located the commit we want we issue the “rollback” command. I’ll rollback to my third commit, reinstating the traffic policy.</p><p>Command: “rollback x” substitute x with your chosen commit revision, note a system reboot is required.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rollback x
</pre></table></code></div></div><p>Example:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>richj@ph-gfw01# rollback 3
Proceed with reboot? <span class="o">[</span>confirm]
</pre></table></code></div></div><h1 id="remote-archiving">Remote archiving</h1><p>The rule of backups includes remote, off local device. How remote I’ll leave up to you (consider how you’ll retreive the configuration in a system outage).</p><p>This is super easy, but needs some sort of remote storage; SFTP / SCP are perhaps the only ones I’d recommend as they provide encryption in transport protection but TFTP and FTP are supported, but unless being use locally on a trusted network I would steer away from these.</p><p>The command you’ll need is “set system config-management commit-archive location SCP://user:password@host/dir”</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">set </span>system config-management commit-archive location x
</pre></table></code></div></div><p>Example:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>richj@ph-gfw01# <span class="nb">set </span>system config-management commit-archive location scp://richj:notreallymypassword@fakehost.com/backup
s
<span class="o">[</span>edit]
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/network/'>Network</a>, <a href='/categories/vyos/'>VyOS</a>, <a href='/categories/foss/'>FOSS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/vyos/" class="post-tag no-text-decoration" >VyOS</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=VyOS - Configuration Backups - blog.cymylau.uk&amp;url=https://blog.cymylau.uk/posts/vyos-configuration-backups/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=VyOS - Configuration Backups - blog.cymylau.uk&amp;u=https://blog.cymylau.uk/posts/vyos-configuration-backups/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://blog.cymylau.uk/posts/vyos-configuration-backups/&amp;text=VyOS - Configuration Backups - blog.cymylau.uk" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/vyos-image-upgrade/">VyOS - Rolling Image Updates</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/vyos/">VyOS</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/vyos-image-upgrade/"><div class="card-body"> <em class="timeago small" data-ts="1656615600" > 2022-06-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>VyOS - Rolling Image Updates</h3><div class="text-muted small"><p> Updating VyOS - Say what now? If you’re lucky enough to have a subscription, either through payment or contribution to this amazing project you can freely download LTS images. For the rest of us ...</p></div></div></a></div><div class="card"> <a href="/posts/static-base-image/"><div class="card-body"> <em class="timeago small" data-ts="1654023600" > 2022-05-31 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Static Base Images</h3><div class="text-muted small"><p> Static Base Images Take the following (simplified docker file) FROM Alpine:latest CMD apk add nginx</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/vyos-image-upgrade/" class="btn btn-outline-primary" prompt="Older"><p>VyOS - Rolling Image Updates</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">Rich Johnson</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/vyos/">VyOS</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en-gb.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
